<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helix: Agentic Recruiter Platform</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background-color: #4a6cf7;
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        main {
            flex: 1;
            display: flex;
            padding: 1rem;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        .app-layout {
            display: flex;
            height: calc(100vh - 120px);
            gap: 1rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .chat-section {
            flex: 1;
            background-color: white;
            display: flex;
            flex-direction: column;
            border-radius: 8px;
        }
        .workspace-section {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            overflow: auto;
        }
        .chat-messages {
            flex: 1;
            overflow: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .chat-input {
            padding: 1rem;
            border-top: 1px solid #eaeaea;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        input, textarea {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        button {
            background-color: #4a6cf7;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #3a5ae8;
        }
        .message {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            max-width: 80%;
        }
        .user-message {
            background-color: #e1ecfe;
            align-self: flex-end;
        }
        .assistant-message {
            background-color: #f2f2f2;
            align-self: flex-start;
        }
        .sequence-step {
            border: 1px solid #eaeaea;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .step-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        .step-number {
            font-weight: 600;
            color: #4a6cf7;
        }
        .step-content {
            white-space: pre-wrap;
        }
        .add-step {
            margin-top: 1rem;
            display: flex;
            justify-content: center;
        }
        h1, h2, h3 {
            margin: 0;
        }
        .placeholder-text {
            text-align: center;
            color: #888;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Helix: Agentic Recruiter Platform</h1>
        </div>
    </header>
    <main>
        <div class="container">
            <div class="app-layout">
                <section class="chat-section">
                    <div class="chat-messages">
                        <div class="message assistant-message">
                            <p>Hello! I'm Helix, your AI recruiting assistant. How can I help you today?</p>
                        </div>
                        <div class="message user-message">
                            <p>I need to create an outreach sequence for a senior developer role.</p>
                        </div>
                        <div class="message assistant-message">
                            <p>I'd be happy to help you create an outreach sequence for a senior developer role. Let me know what kind of tone and approach you'd like to use, and any specific details about the position that would be helpful to include.</p>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" placeholder="Type your message here..." />
                        <button>Send</button>
                    </div>
                </section>
                <section class="workspace-section">
                    <h2>Outreach Sequence</h2>
                    <div class="sequence-step">
                        <div class="step-header">
                            <div class="step-number">Step 1</div>
                            <div class="step-type">Email</div>
                        </div>
                        <div class="step-content">
                            Subject: Exciting Senior Developer Opportunity at [Company]

Hi [Name],

I came across your profile and was impressed by your experience with [relevant technology]. We're looking for a Senior Developer to join our team at [Company], and I think your background could be a great fit.

Would you be open to a quick chat about this opportunity?

Best,
[Your Name]
                        </div>
                    </div>
                    <div class="sequence-step">
                        <div class="step-header">
                            <div class="step-number">Step 2</div>
                            <div class="step-type">Message</div>
                        </div>
                        <div class="step-content">
                            Hi [Name], just following up on my email about the Senior Developer role. I'd love to tell you more about the exciting projects we're working on. Let me know if you'd be interested in connecting.
                        </div>
                    </div>
                    <div class="add-step">
                        <button class="add-step-button">Add Step</button>
                        <button class="generate-sequence" style="margin-left: 10px; background-color: #6a5af9;">Generate with AI</button>
                    </div>
                    
                    <!-- AI Generation Modal -->
                    <div id="ai-modal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                        <div class="modal-content" style="background-color: white; padding: 20px; border-radius: 8px; width: 500px; max-width: 90%;">
                            <h3>Generate Sequence with AI</h3>
                            <div style="margin-bottom: 15px;">
                                <label for="job-title">Job Title:</label>
                                <input type="text" id="job-title" style="width: 100%; margin-top: 5px;" placeholder="e.g., Senior Frontend Developer">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="company-name">Company Name:</label>
                                <input type="text" id="company-name" style="width: 100%; margin-top: 5px;" placeholder="e.g., Acme Inc.">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label for="job-details">Additional Details (optional):</label>
                                <textarea id="job-details" style="width: 100%; margin-top: 5px; height: 100px;" placeholder="Skills, requirements, company culture, etc."></textarea>
                            </div>
                            <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                                <button id="cancel-generate" style="background-color: #f2f2f2; color: #333;">Cancel</button>
                                <button id="confirm-generate" style="background-color: #4a6cf7;">Generate</button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>
    <script>
        // Placeholder for dynamic functionality
        // This would be replaced with the React application
        document.addEventListener('DOMContentLoaded', () => {
            const inputField = document.querySelector('.chat-input input');
            const sendButton = document.querySelector('.chat-input button');
            const chatMessages = document.querySelector('.chat-messages');
            
            // AI Modal elements
            const generateButton = document.querySelector('.generate-sequence');
            const aiModal = document.getElementById('ai-modal');
            const cancelButton = document.getElementById('cancel-generate');
            const confirmButton = document.getElementById('confirm-generate');
            const jobTitleInput = document.getElementById('job-title');
            const companyNameInput = document.getElementById('company-name');
            const jobDetailsInput = document.getElementById('job-details');
            const workspaceSection = document.querySelector('.workspace-section');
            
            // Simple function to add a message
            const addMessage = (text, isUser) => {
                const message = document.createElement('div');
                message.className = `message ${isUser ? 'user-message' : 'assistant-message'}`;
                const p = document.createElement('p');
                p.textContent = text;
                message.appendChild(p);
                chatMessages.appendChild(message);
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            };
            
            // Function to send a message to the AI backend
            const sendMessageToAI = async (text) => {
                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ content: text }),
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to send message');
                    }
                    
                    // The assistant's response will come via WebSocket
                    
                } catch (error) {
                    console.error('Error sending message:', error);
                    addMessage('Sorry, there was an error sending your message. Please try again.', false);
                }
            };
            
            // Function to add a sequence step to the workspace
            const addSequenceStep = (step) => {
                const stepElement = document.createElement('div');
                stepElement.className = 'sequence-step';
                stepElement.innerHTML = `
                    <div class="step-header">
                        <div class="step-number">Step ${step.stepNumber}</div>
                        <div class="step-type">${step.type.charAt(0).toUpperCase() + step.type.slice(1)}</div>
                    </div>
                    <div class="step-content">${step.content}</div>
                `;
                
                // Insert before the add-step button
                const addStepDiv = document.querySelector('.add-step');
                workspaceSection.insertBefore(stepElement, addStepDiv);
            };
            
            // Function to generate a sequence with AI
            const generateSequence = async () => {
                const jobTitle = jobTitleInput.value.trim();
                const companyName = companyNameInput.value.trim();
                const details = jobDetailsInput.value.trim();
                
                if (!jobTitle || !companyName) {
                    alert('Job title and company name are required');
                    return;
                }
                
                try {
                    // Show loading state
                    confirmButton.textContent = 'Generating...';
                    confirmButton.disabled = true;
                    
                    const response = await fetch('/api/sequences/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            job_title: jobTitle,
                            company_name: companyName,
                            details: details
                        }),
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to generate sequence');
                    }
                    
                    const sequence = await response.json();
                    
                    // Clear existing steps
                    const existingSteps = document.querySelectorAll('.sequence-step');
                    existingSteps.forEach(step => step.remove());
                    
                    // Update title
                    const titleElement = document.querySelector('.workspace-section h2');
                    titleElement.textContent = sequence.title;
                    
                    // Add new steps
                    sequence.steps.forEach(step => {
                        addSequenceStep(step);
                    });
                    
                    // Close modal
                    aiModal.style.display = 'none';
                    
                    // Add message to chat
                    addMessage(`I've generated a new outreach sequence for a ${jobTitle} at ${companyName}. Check it out in the workspace!`, false);
                    
                } catch (error) {
                    console.error('Error generating sequence:', error);
                    alert('Failed to generate sequence. Please try again.');
                } finally {
                    // Reset button
                    confirmButton.textContent = 'Generate';
                    confirmButton.disabled = false;
                }
            };
            
            // Handle send button click
            sendButton.addEventListener('click', () => {
                const text = inputField.value.trim();
                if (text) {
                    addMessage(text, true);
                    inputField.value = '';
                    
                    // Send message to AI backend
                    sendMessageToAI(text);
                }
            });
            
            // Handle enter key
            inputField.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendButton.click();
                }
            });
            
            // Handle generate button click
            generateButton.addEventListener('click', () => {
                aiModal.style.display = 'flex';
            });
            
            // Handle cancel button click
            cancelButton.addEventListener('click', () => {
                aiModal.style.display = 'none';
            });
            
            // Handle confirm button click
            confirmButton.addEventListener('click', generateSequence);
            
            // Close modal when clicking outside
            aiModal.addEventListener('click', (e) => {
                if (e.target === aiModal) {
                    aiModal.style.display = 'none';
                }
            });
            
            // Set up WebSocket connection for real-time updates
            const setupWebSocket = () => {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const socket = new WebSocket(`${protocol}//${window.location.host}/socket.io/`);
                
                socket.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        
                        // Handle different message types
                        if (data.event === 'message') {
                            // Add new message to chat
                            addMessage(data.data.content, data.data.role === 'user');
                        } else if (data.event === 'sequence_update') {
                            // Update sequence in workspace
                            console.log('Sequence updated:', data.data);
                            // Implementation would depend on the specific UI update needed
                        }
                    } catch (error) {
                        console.error('Error processing WebSocket message:', error);
                    }
                };
                
                socket.onclose = () => {
                    // Attempt to reconnect
                    setTimeout(setupWebSocket, 3000);
                };
            };
            
            // Initialize WebSocket
            // setupWebSocket();
        });
    </script>
</body>
</html>